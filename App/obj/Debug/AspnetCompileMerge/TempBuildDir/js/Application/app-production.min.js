Ext.define("App.enum.Enums",{items:{},getItems:function(){var n=[];for(var t in this.items)n.push({Name:this.items[t],Value:t});return n},getRenderer:function(n){return this.items[n]||""},getFilter:function(){return{xtype:"combobox",type:"list",store:this.getStore(!0),multiSelect:!1,displayField:"Name",valueField:"Value"}},getStore:function(n){return Ext.create("Ext.data.Store",{fields:["Value","Name"],data:n?[{Name:"-",Value:null}].concat(this.getItems()):this.getItems()})}});Ext.define("App.enum.Month",{extend:"App.enum.Enums",singleton:!0,items:{1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Декабрь"},getRenderer:function(n){return App.enum.Month.items[n]||""},getStore:function(n){return Ext.create("Ext.data.Store",{fields:["Id","Name"],data:n?[{Name:"-",Id:null}].concat(this.getItems()):this.getItems()})},getItems:function(){var n=[];for(var t in this.items)n.push({Name:this.items[t],Id:t});return n}});Ext.define("App.enum.OperatorStatus",{extend:"App.enum.Enums",singleton:!0,items:{10:"Активный",20:"Удалился"},getRenderer:function(n){return App.enum.OperatorStatus.items[n]||""}});Ext.define("App.enum.YesOrNo",{extend:"App.enum.Enums",singleton:!0,items:{10:"Нет",20:"Да"},getRenderer:function(n){return App.enum.YesOrNo.items[n]||""}});Ext.define("App.enum.ActiveStatus",{extend:"App.enum.Enums",singleton:!0,items:{0:"Не активен",10:"Активен"},getRenderer:function(n){return App.enum.ActiveStatus.items[n]||""}});Ext.define("App.enum.PaymentTransferDecision",{extend:"App.enum.Enums",singleton:!0,items:{0:"Отсутствует",10:"Отменил отправитель",20:"Отменил получатель",30:"Получил получатель"},getRenderer:function(n){return App.enum.PaymentTransferDecision.items[n]||""}});Ext.define("App.enum.PaymentType",{extend:"App.enum.Enums",singleton:!0,items:{0:"Отсутствует",10:"Пополнение cчета",20:"Перевод счета на счет"},getRenderer:function(n){return App.enum.PaymentType.items[n]||""}});Ext.apply(Ext.form.VTypes,{phoneText:"Телефон должен состоять из 11 или 12 цифр",phoneMask:/[\-\+0-9\(\)\s\.Ext]/,phoneRe:/^(^(\d{11})|^(\d{12}))$/,phone:function(n){return this.phoneRe.test(n)},phoneEmptyText:"89776665544 или 88437776655"});Ext.apply(Ext.util.Format,{phoneNumber:function(n){var t=n.replace(/\./g,"").replace(/-/g,"").replace(/[^0-9]/g,"");return t===""||t.length!==10,n}});Ext.define("Ext.form.field.Month",{extend:"Ext.form.field.Date",alias:"widget.monthfield",requires:["Ext.picker.Month"],alternateClassName:["Ext.form.MonthField","Ext.form.Month"],selectMonth:null,createPicker:function(){var n=this,t=Ext.String.format;return Ext.create("Ext.picker.Month",{pickerField:n,ownerCt:n.ownerCt,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,minDate:n.minValue,maxDate:n.maxValue,disabledDatesRE:n.disabledDatesRE,disabledDatesText:n.disabledDatesText,disabledDays:n.disabledDays,disabledDaysText:n.disabledDaysText,format:n.format,showToday:n.showToday,startDay:n.startDay,minText:t(n.minText,n.formatDate(n.minValue)),maxText:t(n.maxText,n.formatDate(n.maxValue)),listeners:{afterrender:{scope:n,fn:function(n){var t=n;t.el.on("mousedown",function(n){n.preventDefault()},n)}},select:{scope:n,fn:n.onSelect},monthdblclick:{scope:n,fn:n.onOKClick},yeardblclick:{scope:n,fn:n.onOKClick},OkClick:{scope:n,fn:n.onOKClick},CancelClick:{scope:n,fn:n.onCancelClick}},keyNavConfig:{esc:function(){n.collapse()}}})},onCancelClick:function(){var n=this;n.selectMonth=null;n.collapse()},onOKClick:function(){var n=this;n.selectMonth&&(n.setValue(n.selectMonth),n.fireEvent("select",n,n.selectMonth));n.collapse()},onSelect:function(n,t){var i=this;i.selectMonth=new Date(t[0]+1+"/1/"+t[1])}});Ext.define("App.ux.form.PhoneField",{extend:"Ext.form.field.Text",xtype:"ux-phonefield",config:{valueTpl:null,tplValue:"(___) ___-____",leftValue:null,leftReadOnly:!1},maskRe:/[0-9]/,applyValueTpl:function(n){return n&&!n.isTemplate&&(n=new Ext.XTemplate(n)),n},updateTplValue:function(n){for(var u=n.split(""),t=0,e=u.length,i="",f=0,r;t<e;t++)r=u[t],r!=="_"?i+=r:(i+="{[values["+f+"]]}",f++);this.setValueTpl(i)},initEvents:function(){var n=this,t=n.inputEl;n.callParent();n.selectOnFocus||n.emptyText||n.mon(t,"mousedown",n.focusEnd,n);n.enableKeyEvents||(n.mon(t,"keydown",n.onKeyDown,n),n.mon(t,"keyup",n.onKeyUp,n))},onFocus:function(){this.callParent(arguments);this.focusEnd()},onMouseDown:function(n){this.callParent(arguments);this.focusEnd(n)},focusEnd:function(n){var t=this,i=t.getRawValue().length;setTimeout(function(){t.selectText(i,i)},10);n&&n.isEvent&&n.preventDefault()},onKeyDown:function(n){var t=this,i=n.getCharCode(),r=String.fromCharCode(n.getCharCode());!/[0-9]+/.test(r)&&i<96&&i>105?n.stopEvent():t.enableKeyEvents&&t.callParent(arguments)},onKeyUp:function(n){var t=this,i=n.getCharCode(),r=String.fromCharCode(n.getCharCode());(/[0-9]+/.test(r)||i>95&&i<106)&&t.setValue(t.getValue());t.callParent(arguments)},processRawValue:function(n){return n=this.callParent([n]),n.replace(/[^0-9]/g,"")},valueToRaw:function(n){var t=this,o=t.getValueTpl(),e=t.getTplValue().replace(/[^0-9_]/g,""),u=e.length,i=t.getLeftValue()||"",f=0,r;return i&&(i=i.toString(),f=i.length,n&&(n=n.replace(new RegExp("^"+i),""),f+=n.length)),n=t.callParent([n]).replace(/[^0-9]/g,""),r=n.length,n=i+e.substr(f,u-r)+n,n=n.split(""),r=n.length,!t.getLeftReadOnly()&&r>u&&(n=Ext.Array.slice(n,r-u)),t.callParent([o.apply(n)])}});Ext.define("App.ux.form.SelectField",{extend:"Ext.form.field.Trigger",alias:"widget.appselectfield",alternateClassName:["App.SelectField"],requires:["Ext.grid.Panel","Ext.ux.grid.FilterBar"],allowBlank:!0,listView:null,windowContainerSelector:null,modalWindow:!0,windowCfg:null,editView:null,store:null,selectionMode:"SINGLE",title:"Выбор элемента",idProperty:"Id",textProperty:"Name",isGetOnlyIdProperty:!0,columns:null,trigger1Cls:"x-form-search-trigger",trigger2Cls:"x-form-clear-trigger",getStore:function(){return this.store},constructor:function(){var n=this;n.callParent(arguments);Ext.apply(n,{_toolbarSelectBtnConfig:{xtype:"button",text:"Выбрать",iconCls:"fa fa-check si-green",handler:n.onSelectValue,scope:n},_toolbarCloseBtnConfig:{xtype:"button",text:"Закрыть",iconCls:"fa fa-times si-red",handler:n.onSelectWindowClose,scope:n},_toolbarSelectAllBtnConfig:{xtype:"button",text:"Выбрать все",iconCls:"icon-basket-add",handler:n.onSelectAll,scope:n}})},initComponent:function(){var n=this,t=n.store;if(t?Ext.isString(t)&&(n.store=Ext.StoreMgr.lookup(t),Ext.isEmpty(n.store)&&(n.store=Ext.create(t))):n.store=n.model&&Ext.isString(n.model)?Ext.create("Ext.data.Store",{model:n.model,autoLoad:!1,groupField:n.storeGroupField||null}):Ext.StoreMgr.lookup("ext-empty-store"),!Ext.isEmpty(n.store)&&Ext.isFunction(n.store.on))n.store.on("beforeload",n.onStoreBeforeLoad,n);n.callParent(arguments)},onStoreBeforeLoad:function(n,t){var r=this,i={};i.params=t.params||{};r.fireEvent("beforeload",r,i,n);Ext.apply(t,i)},destroy:function(){var n=this;n.store&&n.store.un("beforeload",n.onStoreBeforeLoad);n.selectWindow&&n.selectWindow.destroy();n.callParent(arguments)},_makeSelectionModel:function(){var n=this,t=n.selectionMode.toUpperCase(),i=Ext.create("Ext.tip.ToolTip",{html:"Выбрать все отображаемые записи"});return Ext.create("Ext.selection.CheckboxModel",{mode:n.selectionMode,checkOnly:n.selectionMode=="MULTI",multipageSelection:{},getSelected:function(){return this.multipageSelection},listeners:{selectionchange:function(t,i){if(i.length!=0||this.store.loading!=!0||this.store.currentPage==this.page){if(this.store.loading==!0){this.multipageSelection={};return}this.store.data.each(function(n){Ext.Object.each(this.getSelected(),function(t,i){n.id===i.id&&delete this.multipageSelection[t]},this)},this);n.selectionMode.toUpperCase()=="SINGLE"?Ext.each(i,function(n){this.multipageSelection[0]=n},this):Ext.each(i,function(n){Ext.Object.getKey(this.multipageSelection,n)||(this.multipageSelection[Ext.Object.getSize(this.multipageSelection)]=n)},this)}},buffer:5},restoreSelection:function(){this.store||(this.store=n.store);this.store.data.each(function(n){Ext.Object.each(this.getSelected(),function(t,i){n.id===i.id&&this.select(n,!0,!0)},this)},this);this.page=this.store.currentPage}})},onTrigger1Click:function(){var n=this,u=n.selectionMode.toUpperCase(),h,e,c,l,i,o,t,r,f,s,a,v;if(n.fireEvent("beforeselect",n)===!1)return!1;if(h=!1,Ext.isString(u)&&u!="SINGLE"&&u!="MULTI"){console.error("Config error:","incorrect selection mode");return}if(u!=="MULTI"||n.isRendered||(n._toolbarSelectBtnConfig.items.push(n._toolbarSelectAllBtnConfig),n.isRendered=!0),Ext.isEmpty(n.gridView)){if(e=!1,Ext.isString(n.listView)){if(c={title:null,border:!1,closable:!1,store:n.store,selModel:n._makeSelectionModel()},n.columns&&(c.columns=n.columns),n.gridView=Ext.create(n.listView,c),e=!0,Ext.isFunction(n.gridView.getStore))if(l=n.gridView.getStore(),l){n.store=l;n.store.un("beforeload",n.onStoreBeforeLoad,n);n.store.on("beforeload",n.onStoreBeforeLoad,n)}else n.gridView.reconfigure(n.store)}else Ext.isObject(n.listView)&&n.listView.isComponent?(n.gridView=n.listView,n.store=n.listView.store):(i=(Ext.isObject(n.listView)?n.listView.columns:[])||[],Ext.isEmpty(i)&&(Ext.isArray(n.columns)?i=n.columns:Ext.isObject(n.columns)&&(i=[n.columns]),Ext.isEmpty(i)&&i.push({xtype:"gridcolumn",dataIndex:n.textProperty,header:"Ð Ð°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ",flex:1})),o=Ext.apply({},n.listView||{}),Ext.applyIf(o,{xtype:"gridpanel",plugins:[{ptype:"filterbar",renderHidden:!1,showShowHideButton:!0,showClearAllButton:!0}],features:n.features||[],dockedItems:[{xtype:"pagingtoolbar",displayInfo:!0,store:n.store,dock:"bottom"}]}),Ext.apply(o,{title:null,border:!1,store:n.store,columns:i,selModel:n._makeSelectionModel()}),n.gridView=Ext.widget(o),e=!0);e&&(t=n.gridView.getDockedItems('toolbar[dock="top"]'),t&&t.length&&(h=!0,t=t[0],t.insert(0,n._toolbarSelectBtnConfig),t.add("->"),t.add(n._toolbarCloseBtnConfig)),n.fireEvent("gridcreated",n,n.gridView))}n.store.on("load",n.gridView.getSelectionModel().restoreSelection,n.gridView.getSelectionModel());if(u==="SINGLE")n.gridView.on("itemdblclick",function(t,i){return t.getSelectionModel().multipageSelection[0]=i,t.getSelectionModel().select(i,!0,!0),n.onSelectValue.apply(n,arguments)},n);if(n.store.load(),n.gridView.getSelectionModel().deselectAll(!0),!n.selectWindow){r={};Ext.isObject(n.windowCfg)&&Ext.apply(r,n.windowCfg);n.fireEvent("beforewindowcreated",n,r);f=Ext.ComponentQuery.query("tabpanel[type=mainpanel]")[0].getActiveTab();Ext.isString(n.windowContainerSelector)&&(f=Ext.ComponentQuery.query(n.windowContainerSelector),Ext.isArray(f)&&(f=renderTo[0]));Ext.applyIf(r,{height:500,width:600,constrain:!0,modal:n.modalWindow==!0,layout:"fit",title:n.title});Ext.apply(r,{items:[n.gridView],listeners:{close:function(){delete n.gridView;delete n.selectWindow}},dockedItems:h?[]:[{xtype:"toolbar",dock:"top",items:[n._toolbarSelectBtnConfig,"->",n._toolbarCloseBtnConfig]}]});n.selectWindow=Ext.create("Ext.window.Window",r);n.fireEvent("windowcreated",n,n.selectWindow);n.gridView.on("setSavedId",n.onNewSavedId,n)}s=n.selectWindow.down("button[action=add]");s&&n.hideAddBtn&&(s.hide(),s.BlockedShow=!0);a=n.selectWindow.down("button[action=edit]");a&&a.hide();v=n.selectWindow.down("button[action=delete]");v&&v.hide();n.selectWindow.forbitEdit=!0;f.add(n.selectWindow);n.selectWindow.show();n.fireEvent("afterwindowshow",n,n.selectWindow);n.selectWindow.center()},onTrigger2Click:function(){var n=this;n.fireEvent("beforeclear",n)!==!1&&(n.setValue(null),n.updateDisplayedText())},onSelectWindowClose:function(){delete this.gridView;this.selectWindow.close();delete this.selectWindow},onSelectValue:function(){var t=this,n=t.gridView.getSelectionModel().getSelected(),i,r;if(!n||n.length==0){Ext.Msg.alert("Ошибка","Необходимо выбрать запись!");return}if(t.selectionMode.toUpperCase()=="SINGLE"){if(n=n[0]||n.items[0],Ext.isEmpty(n)){Ext.Msg.alert("Ошибка","Необходимо выбрать запись!");return}t.setValue(n.getData())}else{i=[];for(r in n.items)i.push(n.items[r].getData());t.setValue(i)}t.onSelectWindowClose()},onNewSavedId:function(n){var t=this,i=t.getStoreController();Ext.Ajax.request({url:"/"+i+"/Get",params:{id:n},success:function(n){var i=Ext.decode(n.responseText);t.setValue(i);t.selectWindow.close()},failure:function(){}})},getStoreController:function(){var t=this,n=t.gridView.getStore().getProxy().url.split("/");return n.length==3?n[1]:n[0]},onSelectAll:function(){var n=this;n.updateDisplayedText("Выбраны все");n.value="All";n.selectWindow.hide()},setValue:function(n){var t=this,i=t.getValue(),r=t.getErrors()!="";return t.value=n,t.updateDisplayedText(n),t.fireEvent("validitychange",t,r),t.fireEvent("change",t,n,i),t.validate(),t},getValue:function(){var n=this;return Ext.isObject(n.value)?n.isGetOnlyIdProperty?{Id:n.value[n.idProperty]}:n.value:Ext.isArray(n.value)?Ext.Array.map(n.value,function(t){return n.isGetOnlyIdProperty?{Id:t[n.idProperty]}:t}):n.value},getText:function(){return this.rawValue},getSubmitValue:function(){var n=this;if(!Ext.isEmpty(n.idProperty)){if(Ext.isEmpty(n.value))return null;if(Ext.isString(n.value))return n.value;if(Ext.isObject(n.value))return n.value[n.idProperty];if(Ext.isArray(n.value))return Ext.Array.map(n.value,function(t){return t[n.idProperty]})}return n.callParent(arguments)},updateDisplayedText:function(n){var t=this,i;Ext.isString(n)?i=n:(i=n&&n[t.textProperty]?n[t.textProperty]:"",Ext.isEmpty(i)&&Ext.isArray(n)&&(i=Ext.Array.map(n,function(n){return n[t.textProperty]}).join()));t.setRawValue.call(t,i)}});Ext.define("App.ux.form.TagSelectField",{extend:"Ext.form.field.Tag",alias:"widget.apptagselectfield",alternateClassName:["App.TagSelectField"],requires:["Ext.grid.Panel","Ext.ux.grid.FilterBar"],triggers:{clear:{weight:1,cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:"onTrigger3Click",scope:"this"},find:{weight:1,cls:Ext.baseCSSPrefix+"form-search-trigger",handler:"onTrigger2Click",scope:"this"},picker:{weight:1,hidden:!0,scope:"this"}},minChars:2,typeAhead:!1,editable:!1,selectOnFocus:!1,disableKeyFilter:!0,allowBlank:!0,listView:null,windowContainerSelector:null,modalWindow:!0,windowCfg:null,editView:null,viewStore:null,selectionMode:"MULTI",title:"Выбор элемента",valueField:"Id",displayField:"Name",columns:null,trigger2Cls:"x-form-search-trigger",trigger3Cls:"x-form-clear-trigger",pinList:!1,getViewStore:function(){return this.viewStore},constructor:function(){var n=this;n.callParent(arguments);Ext.apply(n,{toolbarSelectBtnConfig:{xtype:"button",text:"Выбрать",iconCls:"fa fa-check si-green",handler:n.onSelectValue,scope:n},toolbarCloseBtnConfig:{xtype:"button",text:"Закрыть",iconCls:"fa fa-times si-red",handler:n.onSelectWindowClose,scope:n}})},initComponent:function(){var n=this,t=n.viewStore;if(t?Ext.isString(t)&&(n.viewStore=Ext.StoreMgr.lookup(t),Ext.isEmpty(n.viewStore)&&(n.viewStore=Ext.create(t))):n.viewStore=n.model&&Ext.isString(n.model)?Ext.create("Ext.data.Store",{model:n.model,autoLoad:!1,groupField:n.storeGroupField||null}):Ext.StoreMgr.lookup("ext-empty-store"),!Ext.isEmpty(n.viewStore)&&Ext.isFunction(n.viewStore.on))n.viewStore.on("beforeload",n.onViewStoreBeforeLoad,n);if(!Ext.isEmpty(n.store)&&Ext.isFunction(n.store.on))n.store.on("beforeload",n.onStoreBeforeLoad,n);n.callParent(arguments)},onStoreBeforeLoad:function(n,t){var i=this,r={};n.proxy.extraParams={excludeId:Ext.encode(i.getIdValues())};r.params=t.params||{};i.fireEvent("beforeload",i,r,n);Ext.apply(t,r)},onViewStoreBeforeLoad:function(n,t){var i=this,r={};n.proxy.extraParams={excludeId:Ext.encode(i.getIdValues())};r.params=t.params||{};i.fireEvent("beforeviewload",i,r,n);Ext.apply(t,r)},destroy:function(){var n=this;n.viewStore&&n.viewStore.un("beforeload",n.onViewStoreBeforeLoad);n.selectWindow&&n.selectWindow.destroy();n.callParent(arguments)},_makeSelectionModel:function(){var n=this,t=n.selectionMode.toUpperCase(),i=Ext.create("Ext.tip.ToolTip",{html:"Выбрать все отображаемые записи"});return Ext.create("Ext.selection.CheckboxModel",{mode:n.selectionMode,checkOnly:n.selectionMode=="MULTI",multipageSelection:{},getSelected:function(){return this.multipageSelection},listeners:{selectionchange:function(t,i){if(i.length!=0||this.viewStore.loading!=!0||this.viewStore.currentPage==this.page){if(this.viewStore.loading==!0){this.multipageSelection={};return}this.viewStore.data.each(function(n){Ext.Object.each(this.getSelected(),function(t,i){n.id===i.id&&delete this.multipageSelection[t]},this)},this);n.selectionMode.toUpperCase()=="SINGLE"?Ext.each(i,function(n){this.multipageSelection[0]=n},this):Ext.each(i,function(n){Ext.Object.getKey(this.multipageSelection,n)||(this.multipageSelection[Ext.Object.getSize(this.multipageSelection)]=n)},this)}},buffer:5},restoreSelection:function(){this.viewStore||(this.viewStore=n.viewStore);this.viewStore.data.each(function(n){Ext.Object.each(this.getSelected(),function(t,i){n.id===i.id&&this.select(n,!0,!0)},this)},this);this.page=this.viewStore.currentPage}})},onTrigger2Click:function(){var n=this,u=n.selectionMode.toUpperCase(),s,e,h,c,i,o,t,r,f,l,a;if(n.fireEvent("beforeselect",n)===!1)return!1;if(s=!1,Ext.isString(u)&&u!="SINGLE"&&u!="MULTI"){console.error("Config error:","incorrect selection mode");return}if(u!=="MULTI"||n.isRendered||(n.isRendered=!0),Ext.isEmpty(n.gridView)){if(e=!1,Ext.isString(n.listView)){if(h={title:null,border:!1,closable:!1,store:n.viewStore,selModel:n._makeSelectionModel()},n.columns&&(h.columns=n.columns),n.gridView=Ext.create(n.listView,h),e=!0,Ext.isFunction(n.gridView.getStore))if(c=n.gridView.getStore(),c){n.viewStore=c;n.viewStore.un("beforeload",n.onViewStoreBeforeLoad,n);n.viewStore.on("beforeload",n.onViewStoreBeforeLoad,n)}else n.gridView.reconfigure(n.viewStore)}else Ext.isObject(n.listView)&&n.listView.isComponent?(n.gridView=n.listView,n.viewStore=n.listView.viewStore):(i=(Ext.isObject(n.listView)?n.listView.columns:[])||[],Ext.isEmpty(i)&&(Ext.isArray(n.columns)?i=n.columns:Ext.isObject(n.columns)&&(i=[n.columns]),Ext.isEmpty(i)&&i.push({xtype:"gridcolumn",dataIndex:n.textProperty,header:"Наименование",flex:1})),o=Ext.apply({},n.listView||{}),Ext.applyIf(o,{xtype:"gridpanel",plugins:[{ptype:"filterbar",renderHidden:!1,showShowHideButton:!0,showClearAllButton:!0}],features:n.features||[],dockedItems:[{xtype:"pagingtoolbar",displayInfo:!0,store:n.viewStore,dock:"bottom"}]}),Ext.apply(o,{title:null,border:!1,store:n.viewStore,columns:i,selModel:n._makeSelectionModel()}),n.gridView=Ext.widget(o),e=!0);e&&(t=n.gridView.getDockedItems('toolbar[dock="top"]'),t&&t.length&&(s=!0,t=t[0],t.insert(0,n.toolbarSelectBtnConfig),t.add("->"),t.add(n.toolbarCloseBtnConfig)),n.fireEvent("gridcreated",n,n.gridView))}n.viewStore.on("load",n.gridView.getSelectionModel().restoreSelection,n.gridView.getSelectionModel());if(u==="SINGLE")n.gridView.on("itemdblclick",function(t,i){return t.getSelectionModel().multipageSelection[0]=i,t.getSelectionModel().select(i,!0,!0),n.onSelectValue.apply(n,arguments)},n);if(n.viewStore.load(),n.gridView.getSelectionModel().deselectAll(!0),!n.selectWindow){r={};Ext.isObject(n.windowCfg)&&Ext.apply(r,n.windowCfg);n.fireEvent("beforewindowcreated",n,r);f=Ext.ComponentQuery.query("tabpanel[type=mainpanel]")[0].getActiveTab();Ext.isString(n.windowContainerSelector)&&(f=Ext.ComponentQuery.query(n.windowContainerSelector),Ext.isArray(f)&&(f=renderTo[0]));Ext.applyIf(r,{height:500,width:600,constrain:!0,modal:n.modalWindow==!0,layout:"fit",title:n.title});Ext.apply(r,{items:[n.gridView],listeners:{close:function(){delete n.gridView;delete n.selectWindow}},dockedItems:s?[]:[{xtype:"toolbar",dock:"top",items:[n.toolbarSelectBtnConfig,"->",n.toolbarCloseBtnConfig]}]});n.selectWindow=Ext.create("Ext.window.Window",r);n.fireEvent("windowcreated",n,n.selectWindow);n.gridView.on("setSavedId",n.onNewSavedId,n)}l=n.selectWindow.down("button[action=edit]");l&&l.hide();a=n.selectWindow.down("button[action=delete]");a&&a.hide();n.selectWindow.forbitEdit=!0;f.add(n.selectWindow);n.selectWindow.show();n.fireEvent("afterwindowshow",n,n.selectWindow);n.selectWindow.center()},onTrigger3Click:function(){var n=this;n.fireEvent("beforeclear",n)!==!1&&(n.setValue(null),n.updateDisplayedText())},onSelectWindowClose:function(){delete this.gridView;this.selectWindow.close();delete this.selectWindow},onSelectValue:function(){var n=this,t=n.gridView.getSelectionModel().getSelected(),i;if(!t||t.length==0){Ext.Msg.alert("Ошибка","Необходимо выбрать запись!");return}n.applyChanges=!0;for(i in t.items)Ext.Array.findBy(n.valueCollection.items,function(n){if(n.data.Id===t.items[i].data.Id)return!0})||n.valueCollection.add(t.items[i]);n.fireEvent("afterSelectValue",t);n.updateValue();n.onSelectWindowClose()},onNewSavedId:function(n){var t=this,i=t.getStoreController();Ext.Ajax.request({url:"/"+i+"/Get",params:{id:n},success:function(n){var r=Ext.decode(n.responseText),i=Ext.create("Ext.data.Model",r),u=t.valueCollection;t.valueCollection.add(i);t.fireEvent("afterSelectValue",i);t.updateValue();t.validate();t.selectWindow.close()},failure:function(){}})},getStoreController:function(){var t=this,n=t.gridView.getStore().getProxy().url.split("/");return n.length==3?n[1]:n[0]},checkChange:function(){var n=this,i,t;n.suspendCheckChange||n.destroying||n.destroyed||(i=n.getValue(),t=n.lastValue,needSetOldValue=!1,n.applyChanges&&n.didValueChange(i,t)&&(needSetOldValue?n.setValue(t):n.callParent(arguments),n.applyChanges=!1))},getValue:function(){var t=this.callParent(arguments),n=[];return Ext.each(t,function(t){n.push({Id:t})}),n},getIdValues:function(){var t=this.getValue(),n=[];return Ext.each(t,function(t){n.push(t.Id)}),n},setValue:function(n){if(n&&n.length>0){var t=this;Ext.each(n,function(n){t.valueCollection.add(Ext.create("Ext.data.Model",n))})}},onSelectionChange:function(){return},beforeQueryDefValue:!1,beforeQuery:function(n){var t=this;return t.fireEvent("beforequery",n)!==!1&&(t.beforeQueryDefValue||n.query)?n.cancel||n.query.length<t.minChars&&!n.forceAll&&(n.cancel=!0):n.cancel=!0,n}});Ext.define("App.model.Message",{extend:"Ext.data.Model",fields:[{name:"Id"},{name:"OperatorFrom"},{name:"OperatorTo"},{name:"Name"},{name:"Date"},{name:"Text"}],idProperty:"Id",defaultValuesExist:!0});Ext.define("App.model.Operator",{extend:"Ext.data.Model",fields:[{name:"Id"},{name:"Surname"},{name:"Name"},{name:"Patronymic"},{name:"Login"},{name:"Password"},{name:"Email"},{name:"Phone"},{name:"Status"},{name:"Position"},{name:"Roles"},{name:"Subdivisions"},{name:"CanSetSign"},{name:"SignDateEnd"},{name:"SignPosition"},{name:"CurrentSubdivisionId"},{name:"CurrentSubdivision"},{name:"SignAccesDocument"}],idProperty:"Id"});Ext.define("App.model.Payment",{extend:"Ext.data.Model",fields:[{name:"Id"},{name:"OperatorFrom"},{name:"OperatorTo"},{name:"Amount"},{name:"Date"},{name:"IsCurrent"}],idProperty:"Id",defaultValuesExist:!0});Ext.define("App.model.PaymentTransfer",{extend:"Ext.data.Model",fields:[{name:"Id"},{name:"OperatorFrom"},{name:"OperatorTo"},{name:"AmountFrom"},{name:"AmountTo"},{name:"Comission"},{name:"Date"},{name:"Decision"},{name:"Text"}],idProperty:"Id",defaultValuesExist:!0});Ext.define("App.model.Role",{extend:"Ext.data.Model",fields:[{name:"Id"},{name:"Subdivision"},{name:"Name"}],idProperty:"Id",defaultValuesExist:!0});Ext.define("App.store.BalanceHistory",{extend:"Ext.data.Store",autoLoad:!0,autoSync:!0,remoteFilter:!0,remoteSort:!0,fields:[{name:"Id",type:"int"},{name:"ObjectCreateDate",type:"string"},{name:"DateTo",type:"date"},{name:"DateFrom",type:"date"},{name:"Amount",type:"number"}],proxy:{type:"ajax",url:"/Operator/BalanceHistory",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}});Ext.define("App.store.Message",{extend:"Ext.data.Store",autoLoad:!0,autoSync:!0,remoteFilter:!0,remoteSort:!0,fields:[{name:"Id",type:"int"},{name:"ObjectCreateDate",type:"string"},{name:"OperatorFrom",type:"string"},{name:"Date",type:"date"},{name:"Name",type:"auto"}],proxy:{type:"ajax",url:"/Message/List",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}});Ext.define("App.store.Operator",{extend:"Ext.data.Store",autoLoad:!1,autoSync:!1,remoteFilter:!0,remoteSort:!0,fields:[{name:"Id",type:"int"},{name:"FIO",type:"string"},{name:"Login",type:"string"},{name:"Status",type:"auto"},{name:"IsFavorite",type:"auto"}],proxy:{type:"ajax",url:"/Operator/List",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}});Ext.define("App.store.Payment",{extend:"Ext.data.Store",autoLoad:!0,autoSync:!0,remoteFilter:!0,remoteSort:!0,fields:[{name:"Id",type:"int"},{name:"ObjectCreateDate",type:"string"},{name:"From",type:"string"},{name:"Date",type:"date"},{name:"Amount",type:"number"},{name:"BalanceAmount",type:"number"},{name:"Type",type:"auto"}],proxy:{type:"ajax",url:"/Payment/List",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}});Ext.define("App.store.PaymentTransfer",{extend:"Ext.data.Store",autoLoad:!0,autoSync:!0,remoteFilter:!0,remoteSort:!0,fields:[{name:"Id",type:"int"},{name:"ObjectCreateDate",type:"string"},{name:"OperatorFrom",type:"string"},{name:"OperatorTo",type:"string"},{name:"Date",type:"date"},{name:"Amount",type:"number"},{name:"Decision",type:"auto"},{name:"IsMyTransaction",type:"auto"},],proxy:{type:"ajax",url:"/PaymentTransfer/List",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}});Ext.define("App.store.Role",{extend:"Ext.data.Store",autoLoad:!0,autoSync:!0,remoteFilter:!0,remoteSort:!0,fields:[{name:"Id",type:"int"},{name:"ObjectCreateDate",type:"string"},{name:"Name",type:"string"}],proxy:{type:"ajax",url:"/Role/List",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}});Ext.define("App.base.Controller",{extend:"Ext.app.ViewController",alias:"controller.base",controllerName:"",editWindow:"",onShowWindow:function(){},onTbarFilterChange:function(n,t){if(n.filterName){var r=n.up("grid")||n.up("panel"),i=r.getStore();i.getProxy().setExtraParam(n.filterName,t);i.reload()}},onGridSelectionChange:function(n,t){var f=n.view.up("grid"),r=f.down("button[action=edit]"),i,u;t.length>1?r.disable():(r&&r.enable(),t[0]&&(i=f.up("panel"),i&&i.getForm&&(u=i.getForm(),u&&u.loadRecord(t[0]))))},onCellDBClick:function(n,t,i,r){var u=n.up("window");if(!u||!u.forbitEdit)this.onGridEdit(Ext.create(this.formModel,{Id:r.get("Id")}),n.ownerCt)},onEditBtnClick:function(n){var t=n.getSelectionModel().getSelection().map(function(n){return n}),i;if(t&&t[0]&&(i=t[0].get("Id"),i))this.onGridEdit(Ext.create(this.formModel,{Id:i}),n)},onSaveBtnClick:function(n){n.down("button[action=Save]").disable();n.down("button[action=Cancel]").disable();this.onSaveClick(n)},onCancelBtnClick:function(n){var u=!1,r=n.query("multiupload"),t,i;if(r.length>0)for(t=0;t<r.length;t++)if(i=r[t].getStore(),i.getRejectRecords().length>0||i.getRemovedRecords().length>0||i.getRange().some(function(n){return n.crudState==="R"})){u=!0;break}u?Ext.Msg.show({title:"Предупреждение",msg:"Вы действительно хотите закрыть не сохранив изменения по файлам?",buttons:Ext.Msg.YESNO,fn:function(t){t==="yes"&&n.close()}}):n.close()},onSaveClick:function(n){var r=n.down("form"),s=r.getForm(),u=this,f=n.down("button[action=Save]"),t=n.down("button[action=Cancel]"),i,h,e,o;s.isValid()?(i=r.getRecord(),r.updateRecord(i),i=u.setExtraOnSave(i,n),h=Ext.JSON.encode(i.data),Ext.Ajax.request({url:"/"+u.controllerName+"/Save",jsonData:h,success:function(i){var r=Ext.decode(i.responseText);if(r.success){n.cantCloseAfterSave||n.close();u.onGridRefresh(n.mainComponent)}else f.enable(),t&&t.enable(),Ext.Msg.alert("Ошибка при сохранении карточки",r?r.message:"Неизвестная ошибка")},failure:function(n){f.enable();t&&t.enable();var i=Ext.decode(n.responseText);Ext.Msg.alert("Ошибка при сохранении карточки",i?i.message:"Неизвестная ошибка")},timeout:6e4})):(f.enable(),t&&t.enable(),e="",o=!0,Ext.each(s.getFields().items,function(n){n.validate()||(e+=o?n.fieldLabel:", "+n.fieldLabel,o=!1)}),Ext.Msg.alert("Проверьте корректность полей:",e))},setExtraOnSave:function(n){return n},onGridViewReady:function(n){this.onGridRefresh(n)},onGridRefresh:function(n){n&&n.getStore&&(n.getStore().load(),n.getView().refresh(!0))},onDeleteBtnClick:function(n){var t=this,i=n.getSelectionModel().getSelection().map(function(n){return n.data.Id});i.length>0&&Ext.Msg.show({title:"Предупреждение",msg:"Вы действительно хотите удалить?",buttons:Ext.Msg.YESNO,fn:function(r){r==="yes"&&Ext.Ajax.request({url:"/"+t.controllerName+"/Delete",proxy:{writer:{type:"json"}},params:{ids:Ext.JSON.encode(i)},success:function(i){var r=Ext.decode(i.responseText);r.success||Ext.Msg.alert("Ошибка при удалении",r.message);t.onGridRefresh(n)},failure:function(n){Ext.msg("Ошибка при удалении",Ext.decode(n.statusText).message)},timeout:6e4})}})},onCreateBtnClick:function(n){var o=this,t=Ext.create("widget."+this.editWindow,{mainComponent:n,modal:!0}),u,i,e;t.isEdit=!1;u=n.up("panel[module != '']")||Ext.ComponentQuery.query("tabpanel[type=mainpanel]")[0].getActiveTab();u.add(t);t.show();t.center();i=t.down("form");i.getForm().isValid();var r=n.selection&&n.selection.data?n.selection.data:null,s=r?{Id:0,Parent:{Id:r.Id,Name:r.Name}}:{Id:0},f=Ext.create(this.formModel,s);i.loadRecord(f);e=null;o.onAfterShowEditWindowWhenCreate(f,t,n,e)},onGridEdit:function(n,t){var i,r,u;n&&n.data&&n.data.Id&&(i=Ext.create("widget."+this.editWindow,{mainComponent:t,modal:!0}),i.objectId=n.data.Id,i.isEdit=!0,r=i.down("form"),r.getForm().isValid(),t.up("panel[module != '']").add(i),i.show(),i.center(),u=this,Ext.Ajax.request({url:"/"+u.controllerName+"/Get",params:{id:n.data.Id},success:function(f){var a=f.responseText,o,e,h,l,s,c;for(n.data=Ext.decode(a),r.loadRecord(n),o=r.query("datefield"),e=0;e<o.length;e++)h=n.data[o[e].name],h&&(l=new Date(h),o[e].setValue(l));for(s=r.query("filefield"),e=0;e<s.length;e++)c=n.data[s[e].name],c&&s[e].setRawValue(c);u.onAfterGridGet(n,i,t);r.getForm().isValid()},failure:function(n){Ext.msg("Ошибка при получении",Ext.decode(n.statusText).message)}}))},onAfterGridGet:function(){},onAfterShowEditWindowWhenCreate:function(n,t,i,r){var u=this;n.defaultValuesExist&&Ext.Ajax.request({url:"/"+u.controllerName+"/GetDefaultValues",params:r,success:function(i){var c=i.responseText,u,f,r,o,h,e,s;for(n.data=Ext.decode(c),u=t.down("form"),u.loadRecord(n),f=u.query("datefield"),r=0;r<f.length;r++)o=n.data[f[r].name],o&&(h=new Date(o),f[r].setValue(h));for(e=u.query("filefield"),r=0;r<e.length;r++)s=n.data[e[r].name],s&&e[r].setRawValue(s)},failure:function(n){Ext.msg("Ошибка при получении значений по умолчанию",Ext.decode(n.statusText).message)}})}});Ext.define("App.base.Grid",{extend:"Ext.grid.Panel",PermissionPath:"",listeners:{selectionchange:"onGridSelectionChange",celldblclick:"onCellDBClick",viewready:"onGridViewReady",onDeleteBtnClick:"onDeleteBtnClick",onEditBtnClick:"onEditBtnClick",onCreateBtnClick:"onCreateBtnClick"},tbar:[{iconCls:"fa fa-plus si-green",action:"add",hidden:!0,text:"Добавить",listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onCreateBtnClick",t)}}},{iconCls:"fa fa-pencil si-yellow",action:"edit",hidden:!0,text:"Изменить",listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onEditBtnClick",t)}}},{action:"delete",hidden:!0,iconCls:"fa fa-trash-o si-red",text:"Удалить",listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onDeleteBtnClick",t)}}},{iconCls:" fa fa-refresh si-blue",action:"refresh",text:"Обновить",listeners:{click:function(n){var t=n.up("grid"),i;t&&t.getStore&&(i=t.getStore(),i&&i.load())}}}],initBbar:!0,initComponent:function(){var n=this;Ext.applyIf(n,{selModel:{selType:"checkboxmodel",mode:"MULTI"},plugins:[{ptype:"filterbar",renderHidden:!1,showShowHideButton:!0,showClearAllButton:!0}]});n.initBbar&&Ext.apply(n,{bbar:{xtype:"pagingtoolbar",store:n.store,displayMsg:"Данные на отображение {0} - {1} из {2}",emptyMsg:"Нет данных для просмотра"}});n.callParent()}});Ext.define("App.base.Window",{extend:"Ext.window.Window",layout:"fit",maxHeight:530,width:530,scrollable:!0,autoScroll:!0,defaults:{autoScroll:!0},closable:!1,plain:!0,constrain:!0,listeners:{onSaveBtnClick:"onSaveBtnClick",onCancelBtnClick:"onCancelBtnClick",onPrintFormBtnClick:"onPrintFormBtnClick",show:"onShowWindow"},buttons:[{action:"Save",text:"Сохранить",iconCls:"fa fa-floppy-o",listeners:{click:function(n){var t=n.up("window");t.fireEvent("onSaveBtnClick",t)}}},{action:"Cancel",text:"Отменить",iconCls:"fa fa-undo si-red",listeners:{click:function(n){var t=n.up("window");t.fireEvent("onCancelBtnClick",t)}}}]});Ext.define("App.view.message.Grid",{extend:"App.base.Grid",alias:"widget.messagepanel",controller:"message",requires:["App.store.Message"],viewConfig:{stripeRows:!0},initComponent:function(){this.store=Ext.create("App.store.Message",{listeners:{beforeload:function(n,t){t.params=t.params||{};t.params.IsOther=!0}}});Ext.apply(this,{store:this.store,columns:[{xtype:"datecolumn",text:"Дата",flex:1,dataIndex:"Date",filter:!0},{text:"От кого",flex:1,dataIndex:"OperatorFrom",filter:!0},{text:"Сообщение",flex:1,dataIndex:"Name",filter:!0},],tbar:[{iconCls:"fa fa-plus si-green",action:"add",text:"Добавить",listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onCreateBtnClick",t)}}},{iconCls:" fa fa-refresh si-blue",action:"refresh",text:"Обновить",listeners:{click:function(n){var t=n.up("grid"),i;t&&t.getStore&&(i=t.getStore(),i&&i.load())}}}]});this.callParent()}});Ext.define("App.view.operator.Grid",{extend:"App.base.Grid",alias:"widget.operatorpanel",controller:"operator",requires:["App.store.Operator"],viewConfig:{stripeRows:!0},initComponent:function(){var n=this;this.store=Ext.create("App.store.Operator");Ext.apply(this,{store:this.store,columns:this.columns||[{xtype:"actioncolumn",id:"actionColumnFavorites",width:40,items:[{getClass:function(n,t,i){return i.get("IsFavorite")?(this.items[0].tooltip="Избранный","fa fa-star"):(this.items[0].tooltip="Добавить в избранные","fa fa-star-o")},handler:function(t,i,r,u,f,e){Ext.Ajax.request({url:"/Operator/Favorite",params:{favoriteId:e.get("Id")},success:function(t){var i=Ext.decode(t.responseText);i.success?n.store.reload():Ext.Msg.alert("Ошибка",i?i.message:"Неизвестная ошибка")},failure:function(){Ext.Msg.alert("Ошибка",data?data.message:"Неизвестная ошибка")},timeout:6e4})}}]},{text:"Логин",flex:1,dataIndex:"Login",filter:!0},{text:"ФИО",flex:1,dataIndex:"FIO",filter:!0},{text:"Статус",flex:1,dataIndex:"Status",renderer:App.enum.OperatorStatus.getRenderer,filter:App.enum.OperatorStatus.getFilter()}]});this.callParent()}});Ext.define("App.view.payment.Grid",{extend:"App.base.Grid",alias:"widget.paymentpanel",controller:"payment",requires:["App.store.Payment"],viewConfig:{stripeRows:!0},initComponent:function(){this.store=Ext.create("App.store.Payment",{listeners:{beforeload:function(n,t){t.params=t.params||{};t.params.IsOther=!0}}});Ext.apply(this,{store:this.store,columns:[{xtype:"datecolumn",text:"Дата",flex:1,dataIndex:"Date",filter:!0},{text:"Сумма",flex:1,dataIndex:"Amount",filter:!0},{text:"Баланс",flex:1,dataIndex:"BalanceAmount",filter:!0},{text:"Тип",flex:1,dataIndex:"Type",renderer:App.enum.PaymentType.getRenderer,filter:App.enum.PaymentType.getFilter()},],tbar:[{iconCls:"fa fa-plus si-green",action:"add",text:"Добавить",listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onCreateBtnClick",t)}}},{iconCls:" fa fa-refresh si-blue",action:"refresh",text:"Обновить",listeners:{click:function(n){var t=n.up("grid"),i;t&&t.getStore&&(i=t.getStore(),i&&i.load())}}}]});this.callParent()}});Ext.define("App.view.paymenttransfer.Grid",{extend:"App.base.Grid",alias:"widget.paymenttransferpanel",controller:"paymenttransfer",requires:["App.store.PaymentTransfer"],viewConfig:{stripeRows:!0},listeners:{selectionchange:"onGridSelectionChange",celldblclick:"onCellDBClick",viewready:"onGridViewReady",onCreateBtnClick:"onCreateBtnClick",onRollbackBtnClick:"onRollbackBtnClick",onAcceptBtnClick:"onAcceptBtnClick",onDeclineBtnClick:"onDeclineBtnClick"},initComponent:function(){this.store=Ext.create("App.store.PaymentTransfer",{listeners:{beforeload:function(n,t){t.params=t.params||{};t.params.IsOther=!0}}});Ext.apply(this,{store:this.store,columns:[{xtype:"datecolumn",text:"Дата",flex:1,dataIndex:"Date",filter:!0},{text:"От кого",flex:1,dataIndex:"OperatorFrom",filter:!0},{text:"Кому",flex:1,dataIndex:"OperatorTo",filter:!0},{text:"Сумма",flex:1,dataIndex:"Amount",filter:!0},{text:"Решение",flex:1,dataIndex:"Decision",renderer:App.enum.PaymentTransferDecision.getRenderer,filter:App.enum.PaymentTransferDecision.getFilter()}],tbar:[{iconCls:"fa fa-plus si-green",action:"add",text:"Новый перевод",listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onCreateBtnClick",t)}}},{iconCls:" fa fa-refresh si-blue",action:"refresh",text:"Обновить",listeners:{click:function(n){var t=n.up("grid"),i;t&&t.getStore&&(i=t.getStore(),i&&i.load())}}},{iconCls:"fa fa-close si-red",action:"rollback",text:"Отменить перевод",disabled:!0,listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onRollbackBtnClick",t)}}},{iconCls:"fa fa-check si-green",action:"accept",text:"Принять перевод",disabled:!0,listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onAcceptBtnClick",t)}}},{iconCls:"fa fa-close si-yellow",action:"decline",text:"Отказаться от перевода",disabled:!0,listeners:{click:function(n){var t=n.up("grid");t.fireEvent("onDeclineBtnClick",t)}}},]});this.callParent()}});Ext.define("App.view.role.Grid",{extend:"App.base.Grid",alias:"widget.rolepanel",controller:"role",requires:["App.store.Role"],viewConfig:{stripeRows:!0},initComponent:function(){this.store=Ext.create("App.store.Role",{listeners:{beforeload:function(n,t){t.params=t.params||{};t.params.IsOther=!0}}});Ext.apply(this,{store:this.store,columns:[{text:"Имя",flex:1,dataIndex:"Name",filter:!0}]});this.callParent()}});Ext.define("App.view.message.Window",{extend:"App.base.Window",alias:"widget.messagewindow",controller:"message",title:"Сообщение",items:[{xtype:"form",bodyPadding:"5",fieldDefaults:{labelWidth:100,anchor:"100%"},items:[{xtype:"datefield",fieldLabel:"Дата",name:"Date",allowBlank:!1,editable:!0,readOnly:!0,format:"d.m.Y"},{xtype:"appselectfield",fieldLabel:"От кого",listView:"App.view.operator.Grid",textProperty:"Name",name:"OperatorFrom",allowBlank:!1,model:"App.model.Operator",store:"App.store.Operator",columns:[{text:"ФИО",flex:1,sortable:!0,dataIndex:"FIO",filter:!0}],onStoreBeforeLoad:function(n){n.getProxy().setExtraParam("Status",10)}},{xtype:"textfield",fieldLabel:"Сообщение",name:"Name"},{xtype:"textarea",fieldLabel:"Текст",name:"Text"}]}]});Ext.define("App.view.operator.Window",{extend:"App.base.Window",alias:"widget.operatorwindow",controller:"operator",title:"Сотрудник",items:[{xtype:"form",bodyPadding:"5",fieldDefaults:{labelWidth:100,anchor:"100%"},items:[{xtype:"fieldset",title:"Данные",items:[{xtype:"textfield",fieldLabel:"Фамилия",name:"Surname",allowBlank:!1,maxLength:255},{xtype:"textfield",fieldLabel:"Имя",name:"Name",validateBlank:!0,allowBlank:!1,maxLength:255},{xtype:"textfield",fieldLabel:"Отчество",name:"Patronymic",maxLength:255},{xtype:"textfield",name:"Phone",fieldLabel:"Телефон",allowBlank:!0,vtype:"phone",emptyText:"В формате 89776665544 или 88437776655",maxLength:12},{xtype:"textfield",name:"Email",fieldLabel:"Email",vtype:"email",allowBlank:!0},]},{xtype:"fieldset",title:"Системные данные",items:[{xtype:"textfield",fieldLabel:"Логин",name:"Login",allowBlank:!1,minLength:5,maxLength:32,regex:/^[a-z A-Z0-9._,-]+$/},{xtype:"textfield",fieldLabel:"Пароль",name:"Password",allowBlank:!0,minLength:8,maxLength:32,regex:/^[a-z A-Z0-9._,-]+$/},{name:"Status",xtype:"combobox",editable:!1,fieldLabel:"Статус",valueField:"Value",displayField:"Name",store:App.enum.OperatorStatus.getStore(),value:10,allowBlank:!1},{xtype:"apptagselectfield",fieldLabel:"Роли",listView:"App.view.role.Grid",textProperty:"Name",name:"Roles",model:"App.model.Role",triggerAction:"all",store:Ext.create("Ext.data.Store",{autoLoad:!0,autoSync:!0,fields:[{name:"Id",type:"int"},{name:"ObjectCreateDate",type:"string"},{name:"Name",type:"string"}],proxy:{type:"ajax",url:"/Role/List",method:"GET",reader:{rootProperty:"data",totalProperty:"totalCount"}}}),viewStore:"App.store.Role",allowBlank:!1}]}]}]});Ext.define("App.view.payment.Window",{extend:"App.base.Window",alias:"widget.paymentwindow",controller:"payment",title:"Пополнить баланс",items:[{xtype:"form",bodyPadding:"5",fieldDefaults:{labelWidth:100,anchor:"100%"},items:[{xtype:"numberfield",fieldLabel:"Сумма",name:"Amount"}]}]});Ext.define("App.view.paymenttransfer.Window",{extend:"App.base.Window",alias:"widget.paymenttransferwindow",controller:"paymenttransfer",title:"Денежный перевод",items:[{xtype:"form",bodyPadding:"5",fieldDefaults:{labelWidth:170,anchor:"100%"},items:[{xtype:"datefield",fieldLabel:"Дата",name:"Date",allowBlank:!1,editable:!0,readOnly:!0,format:"d.m.Y"},{xtype:"appselectfield",fieldLabel:"От кого",listView:"App.view.operator.Grid",textProperty:"Name",name:"OperatorFrom",allowBlank:!1,readOnly:!0,model:"App.model.Operator",store:"App.store.Operator",columns:[{text:"ФИО",flex:1,dataIndex:"FIO",filter:!0}],onStoreBeforeLoad:function(n){n.getProxy().setExtraParam("Status",10)}},{xtype:"appselectfield",fieldLabel:"Кому",listView:"App.view.operator.Grid",textProperty:"Name",name:"OperatorTo",allowBlank:!1,model:"App.model.Operator",store:"App.store.Operator",columns:[{xtype:"actioncolumn",id:"actionColumnFavorites",width:40,items:[{getClass:function(n,t,i){return i.get("IsFavorite")?(this.items[0].tooltip="Избранный","fa fa-star"):(this.items[0].tooltip="Добавить в избранные","fa fa-star-o")}}]},{text:"Логин",flex:1,dataIndex:"Login",filter:!0},{text:"ФИО",flex:1,dataIndex:"FIO",filter:!0},{text:"Статус",flex:1,dataIndex:"Status",renderer:App.enum.OperatorStatus.getRenderer,filter:App.enum.OperatorStatus.getFilter()}],onStoreBeforeLoad:function(n){n.getProxy().setExtraParam("Status",10)}},{xtype:"numberfield",fieldLabel:"Сумма к оплате",readOnly:!0,id:"AmountFromItem",name:"AmountFrom"},{xtype:"numberfield",fieldLabel:"Комиссия (5%)",readOnly:!0,id:"ComissionItem",name:"Comission"},{xtype:"numberfield",fieldLabel:"Сумма на перевод",allowDecimal:!1,name:"AmountTo",listeners:{change:function(n,t){var i=n.up("form"),r=t/.95;i.down("#AmountFromItem").setValue(r);i.down("#ComissionItem").setValue(r-t)}}},{name:"Decision",xtype:"combobox",editable:!1,fieldLabel:"Статус",valueField:"Value",displayField:"Name",store:App.enum.PaymentTransferDecision.getStore(),value:0,readOnly:!0,allowBlank:!1},{xtype:"textarea",name:"Text",fieldLabel:"Сообщение"}]}]});Ext.define("App.view.role.Window",{extend:"App.base.Window",alias:"widget.rolewindow",controller:"role",title:"Роль",items:[{xtype:"form",bodyPadding:"5",fieldDefaults:{labelWidth:100,anchor:"100%"},items:[{xtype:"fieldset",title:"Муниципалитет",items:[{xtype:"appselectfield",fieldLabel:"Муниципалитет",listView:"App.view.region.Grid",textProperty:"Name",name:"Subdivision",model:"App.model.Subdivision",store:"App.store.Subdivision",readOnly:!0},{xtype:"textfield",fieldLabel:"Имя",name:"Name",maxLength:256}]}]}]});Ext.define("App.view.message.Controller",{extend:"App.base.Controller",alias:"controller.message",requires:["Ext.data.Store","App.model.Message","App.view.message.Grid","App.view.message.Window"],formModel:"App.model.Message",PermissionPath:"App.Messages",controllerName:"Message",editWindow:"messagewindow"});Ext.define("App.view.operator.Controller",{extend:"App.base.Controller",alias:"controller.operator",requires:["Ext.data.Store","App.model.Operator","App.view.operator.Grid","App.view.operator.Window"],formModel:"App.model.Operator",controllerName:"Operator",editWindow:"operatorwindow",PermissionPath:"App.Operators",routes:{operators:"openGrid"},onChangePasswordSaveButtonClick:function(n){var t=n.down("form").getForm(),i,r;t.isValid()?(i=t.findField("OldPassword").getValue(),r=t.findField("NewPassword").getValue(),Ext.Ajax.request({url:"/Operator/ChangePassword",jsonData:{oldPassword:i,newPassword:r},success:function(t){var i=Ext.decode(t.responseText);i.success?(n.hide(),Ext.Msg.alert("Сообщение","Пароль успешно изменен.")):Ext.Msg.alert("Ошибка при смене пароля",i?i.message:"Неизвестная ошибка.")},failure:function(){Ext.Msg.alert("Ошибка при смене пароля","Неизвестная ошибка.")},timeout:6e4})):Ext.Msg.alert("Ошибка","Заполните поля")},onChangePasswordCancelButtonClick:function(n){n.hide()},onAfterGridGet:function(n,t){this.documentStoreReload(n,t)},onAfterShowEditWindowWhenCreate:function(n,t,i,r){this.superclass.onAfterShowEditWindowWhenCreate.call(this,n,t,i,r);this.documentStoreReload(n,t)},setExtraOnSave:function(n,t){return n.data.SignAccesDocument=this.getDocumentValues(t,"SignAccesDocument"),n},getDocumentValues:function(n,t){var i=n.down("multiupload[name="+t+"]");if(i){var r=i.getStore(),u=r.getRange(),f=Ext.Array.map(u,function(n){return n.data.FileId});return f+""}},documentStoreReload:function(n,t){this.setExtraParamToDocumentGrid(n,t,"SignAccesDocument")},setExtraParamToDocumentGrid:function(n,t,i){var u=t.down("multiupload[name="+i+"]"),r;u&&(r=u.getStore(),r.getProxy().setExtraParam("id",n.getId()),r.load())}});Ext.define("App.view.payment.Controller",{extend:"App.base.Controller",alias:"controller.payment",requires:["Ext.data.Store","App.model.Payment","App.view.payment.Grid","App.view.payment.Window"],formModel:"App.model.Payment",PermissionPath:"App.Payments",controllerName:"Payment",editWindow:"paymentwindow"});Ext.define("App.view.paymenttransfer.Controller",{extend:"App.base.Controller",alias:"controller.paymenttransfer",requires:["Ext.data.Store","App.model.PaymentTransfer","App.view.paymenttransfer.Grid","App.view.paymenttransfer.Window"],formModel:"App.model.PaymentTransfer",PermissionPath:"App.PaymentTransfers",controllerName:"PaymentTransfer",editWindow:"paymenttransferwindow",onRollbackBtnClick:function(n){var t=n.getSelectionModel().selected.items[0];Ext.Ajax.request({url:"/PaymentTransfer/RollbackTransfer",params:{transferId:t.get("Id")},success:function(t){var i=Ext.decode(t.responseText);i.success?n.store.reload():Ext.Msg.alert("Ошибка",i?i.message:"Неизвестная ошибка")},failure:function(){Ext.Msg.alert("Ошибка",data?data.message:"Неизвестная ошибка")},timeout:6e4})},onAcceptBtnClick:function(n){var t=n.getSelectionModel().selected.items[0];Ext.Ajax.request({url:"/PaymentTransfer/AcceptTransfer",params:{transferId:t.get("Id")},success:function(t){var i=Ext.decode(t.responseText);i.success?n.store.reload():Ext.Msg.alert("Ошибка",i?i.message:"Неизвестная ошибка")},failure:function(){Ext.Msg.alert("Ошибка",data?data.message:"Неизвестная ошибка")},timeout:6e4})},onDeclineBtnClick:function(n){var t=n.getSelectionModel().selected.items[0];Ext.Ajax.request({url:"/PaymentTransfer/DeclineTransfer",params:{transferId:t.get("Id")},success:function(t){var i=Ext.decode(t.responseText);i.success?n.store.reload():Ext.Msg.alert("Ошибка",i?i.message:"Неизвестная ошибка")},failure:function(){Ext.Msg.alert("Ошибка",data?data.message:"Неизвестная ошибка")},timeout:6e4})},onGridSelectionChange:function(n,t){var i=t[0],r=n.view.up("grid"),u=r.down("button[action=accept]"),f=r.down("button[action=decline]"),e=r.down("button[action=rollback]");t.length==1?(i.get("CanEdit")&&!i.get("IsMyTransaction")?u.enable():u.disable(),i.get("CanEdit")&&!i.get("IsMyTransaction")?f.enable():f.disable(),i.get("CanEdit")&&i.get("IsMyTransaction")?e.enable():e.disable()):(u.disable(),f.disable(),e.disable())}});Ext.define("App.view.personalarea.Controller",{extend:"App.base.Controller",alias:"controller.personalarea",requires:["Ext.data.Store","App.view.personalarea.Panel","App.view.personalarea.BalanceHistoryGrid"],formModel:"App.model.Operator",PermissionPath:"App.Operator",controllerName:"Operator",editWindow:"personalareapanel",onPanelRendered:function(n){var r=this,t=n.down("form"),i=Ext.create(this.formModel,{Id:0});Ext.Ajax.request({url:"/Operator/GetCurrent",success:function(n){var h=n.responseText,u,r,e,s,f,o;for(i.data=Ext.decode(h),t.loadRecord(i),u=t.query("datefield"),r=0;r<u.length;r++)e=i.data[u[r].name],e&&(s=new Date(e),u[r].setValue(s));for(f=t.query("filefield"),r=0;r<f.length;r++)o=i.data[f[r].name],o&&f[r].setRawValue(o);t.getForm().isValid()},failure:function(n){Ext.msg("Ошибка при получении",Ext.decode(n.statusText).message)}})},onRemoveAccountBtnClick:function(){var n=this;Ext.MessageBox.show({title:"Внимание!",msg:"Будет удален ваш аккунт! Вы уверены?",buttons:Ext.MessageBox.OKCANCEL,icon:Ext.MessageBox.WARNING,fn:function(n){n==="ok"&&Ext.Ajax.request({url:"/Operator/RemoveCurrentAccount",success:function(n){var t=Ext.decode(n.responseText);t.success?Ext.Ajax.request({method:"GET",url:"Login/Logout",success:function(){window.location.href="Home/Index"},failure:function(n){Ext.Msg.alert("Ошибка!",Ext.isString(n.responseData)?n.responseData:n.responseData.message)}}):Ext.Msg.alert("Ошибка",t?t.message:"Неизвестная ошибка")},failure:function(){Ext.Msg.alert("Ошибка",data?data.message:"Неизвестная ошибка")},timeout:6e4})}})}});Ext.define("App.view.role.Controller",{extend:"App.base.Controller",alias:"controller.role",requires:["Ext.data.Store","App.model.Role","App.view.role.Grid","App.view.role.Window"],formModel:"App.model.Role",PermissionPath:"App.Roles",controllerName:"Role",editWindow:"rolewindow",onShowWindow:function(n){n.down("[name=Subdivision]").setReadOnly(!Permission.Access("CanEditSundivision"))}});Ext.define("App.view.Main",{extend:"Ext.container.Viewport",alias:"widget.main",layout:"border",controller:"main",items:[{region:"west",xtype:"treepanel",title:"<b>Меню<\/b>",width:220,buttonAlign:"left",rootVisible:!1,autoScroll:!0,store:Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",method:"GET",url:"MenuItems/GetAll"},listeners:{load:function(n,t,i,r,u){if(t&&t.length>0){var f=u.getOwnerTree();f.fireEvent("itemclick",f,t[0])}}}}),listeners:{itemclick:"createTab",afterlayout:function(){var n=Ext.getBody().getViewSize().height;this.setHeight(n)}},fbar:[{xtype:"container",height:19,layout:{type:"hbox"},items:[{xtype:"label",width:194,listeners:{beforerender:function(n){Ext.Ajax.request({url:"/Operator/GetCurrentOperatorSurnameAndName",success:function(t){var i=Ext.decode(t.responseText);i&&i.surnameAndName&&n.setHtml("<a href='#'>"+i.surnameAndName+"<\/a>")}})},render:function(n){n.getEl().on("click",function(){var n=Ext.create("widget.changepasswordwindow"),t=n.down("form");t.getForm().isValid();n.show()},n)}}},{xtype:"button",iconCls:"fa fa-sign-out si-red",tooltip:"Выйти из системы",scale:"huge",handler:function(){Ext.Ajax.request({method:"GET",url:"Login/Logout",success:function(){window.location.href="Home/Index"},failure:function(n){Ext.Msg.alert("Ошибка!",Ext.isString(n.responseData)?n.responseData:n.responseData.message)}})}}]}]},{region:"center",xtype:"tabpanel",type:"mainpanel",reference:"tabPanelCenter"}]});Ext.define("App.view.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",requires:["Ext.tab.Panel","Ext.tree.Panel"],createTab:function(n,t){var e=this,u=e.lookupReference("tabPanelCenter"),i,r,f;t.get("leaf")&&(i=u.items.findBy(function(n){return n.title===t.get("text")}),i||(r=t.get("module"),f=r==="desktop"?!1:!0,i=u.add({xtype:"panel",module:r,title:t.get("text"),autoShow:!0,closable:f,layout:"fit",items:[{xtype:r+"panel"}]})),u.setActiveTab(i))}});Ext.define("App.view.desktop.Panel",{extend:"Ext.panel.Panel",alias:"widget.desktoppanel",html:'<div style="text-align: center; width: 100%;"><h3>Добро пожаловать!<\/h3><\/div>'});Ext.define("App.view.operator.ChangePasswordWindow",{extend:"App.base.Window",alias:"widget.changepasswordwindow",controller:"operator",title:"Смена пароля",modal:!0,width:500,listeners:{onChangePasswordSaveButtonClick:"onChangePasswordSaveButtonClick",onChangePasswordCancelButtonClick:"onChangePasswordCancelButtonClick"},buttons:[{action:"Save",text:"Сохранить",iconCls:"fa fa-floppy-o",listeners:{click:function(n){var t=n.up("window");t.fireEvent("onChangePasswordSaveButtonClick",t)}}},{action:"Cancel",text:"Отменить",iconCls:"fa fa-undo si-red",listeners:{click:function(n){var t=n.up("window");t.fireEvent("onChangePasswordCancelButtonClick",t)}}}],items:[{xtype:"form",bodyPadding:"5",fieldDefaults:{labelWidth:170,anchor:"100%"},items:[{xtype:"fieldset",title:"Смена пароля",items:[{xtype:"textfield",fieldLabel:"Старый пароль",name:"OldPassword",allowBlank:!1,minLength:8,maxLength:32,regex:/^[a-z A-Z0-9._,-]+$/},{xtype:"textfield",fieldLabel:"Новый пароль",name:"NewPassword",allowBlank:!1,minLength:8,maxLength:32,regex:/^[a-z A-Z0-9._,-]+$/}]}]}]});Ext.define("App.view.personalarea.BalanceHistoryGrid",{extend:"Ext.grid.Panel",alias:"widget.balancehistorypanel",controller:"personalarea",requires:["App.store.BalanceHistory"],viewConfig:{stripeRows:!0},initComponent:function(){this.store=Ext.create("App.store.BalanceHistory",{});Ext.apply(this,{store:this.store,columns:[{xtype:"datecolumn",text:"Дата c",flex:1,dataIndex:"DateFrom",filter:!0},{xtype:"datecolumn",text:"Дата по",flex:1,dataIndex:"DateTo",filter:!0},{text:"Сумма",flex:1,dataIndex:"Amount",filter:!0}],tbar:[{iconCls:" fa fa-refresh si-blue",action:"refresh",text:"Обновить",listeners:{click:function(n){var t=n.up("grid"),i;t&&t.getStore&&(i=t.getStore(),i&&i.load())}}}]});this.callParent()}});Ext.define("App.view.personalarea.Panel",{extend:"Ext.panel.Panel",controller:"personalarea",alias:"widget.personalareapanel",layout:"hbox",defaults:{flex:1,autoHeight:!0,layout:"vbox"},listeners:{afterrender:"onPanelRendered",onSaveClick:"onSaveClick",onRemoveAccountBtnClick:"onRemoveAccountBtnClick"},cantCloseAfterSave:!0,autoScroll:!0,items:[{id:"mainForm",xtype:"form",layout:"form",maxWidth:800,border:!1,bodyPadding:"5",fieldDefaults:{labelWidth:100,anchor:"100%"},items:[{xtype:"fieldset",title:"Общая информация",items:[{xtype:"textfield",fieldLabel:"Фамилия",name:"Surname",allowBlank:!1,maxLength:255},{xtype:"textfield",fieldLabel:"Имя",name:"Name",validateBlank:!0,allowBlank:!1,maxLength:255},{xtype:"textfield",fieldLabel:"Отчество",name:"Patronymic",maxLength:255},{xtype:"textfield",name:"Phone",fieldLabel:"Телефон",allowBlank:!0,vtype:"phone",emptyText:"В формате 89776665544 или 88437776655",maxLength:12},{xtype:"textfield",name:"Email",fieldLabel:"Email",vtype:"email",allowBlank:!0},]},{xtype:"fieldset",title:"Системные данные",items:[{xtype:"textfield",fieldLabel:"Логин",name:"Login",allowBlank:!1,minLength:5,maxLength:32,readOnly:!0,regex:/^[a-z A-Z0-9._,-]+$/},{name:"Status",xtype:"combobox",readOnly:!0,editable:!1,fieldLabel:"Статус",valueField:"Value",displayField:"Name",store:App.enum.OperatorStatus.getStore(),value:10,allowBlank:!1}]},{title:"История баланса",xtype:"balancehistorypanel",minHeight:300,flex:1}],tbar:[{action:"Save",text:"Сохранить",iconCls:"fa fa-floppy-o",listeners:{click:function(n){var t=n.up("personalareapanel");t.fireEvent("onSaveClick",t)}}},{action:"RemoveAccount",text:"Удалить аккаунт",iconCls:"fa fa-trash si-red",listeners:{click:function(n){var t=n.up("personalareapanel");t.fireEvent("onRemoveAccountBtnClick",t)}}}]}]});Ext.define("App.Application",{extend:"Ext.app.Application",requires:["App.view.MainController","App.view.role.Controller","App.view.operator.Controller","App.view.personalarea.Controller","App.view.payment.Controller","App.view.paymenttransfer.Controller","App.view.message.Controller","App.enum.Enums"],name:"App",autoCreateViewport:"App.view.Main"});Ext.application({name:"App",appFolder:"/js/Application/app",paths:{Ext:"/js/ext","App.view":"/js/Application/app/view"},extend:"App.Application",autoCreateViewport:"App.view.Main"});
//# sourceMappingURL=app-production.min.js.map